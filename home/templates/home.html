{% extends "base.html" %}

{% block title %}Intranet Cotrisoja{% endblock %}

{% load static %}

{% block styles %}
<link rel="stylesheet" href="{% static 'home/home_style.css' %}">
<link href="{% static 'home/lightbox/css/lightbox.css' %}" rel="stylesheet" crossorigin="anonymous">
<link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
<link rel="stylesheet" href="{%static 'home/calendar_style.css'%}">
{% endblock %}

{% block content %}
<div class="container-xxl main main-height">
    <div class="row">
        <div class="col-4">
            <div class="wrapper">
                <header>
                    <p class="current-date"></p>
                    <div class="icons">
                        <span id="prev" class="material-symbols-rounded">chevron_left</span>
                        <span id="today" class="material-symbols-rounded">today</span>
                        <span id="next" class="material-symbols-rounded">chevron_right</span>
                    </div>
                </header>
                <div class="calendar mb-auto">
                    <ul class="weeks">
                        <li>Dom</li>
                        <li>Seg</li>
                        <li>Ter</li>
                        <li>Qua</li>
                        <li>Qui</li>
                        <li>Sex</li>
                        <li>Sab</li>
                    </ul>
                    <ul class="days"></ul>
                </div>
            </div>
        </div>
        <div class="col">
            <div id="carouselHome" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">                    
                    {% for banner in Banners %}
                        {% if forloop.counter0 == 0 %}
                            <div class="carousel-item active">                                
                            {% else %}
                            <div class="carousel-item">                                
                        {% endif %}
                        <img src={{banner.imagem.url}} class="d-block w-100">
                        </div>
                    {% endfor %}
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselHome" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselHome" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
    </div>
    <div class="row mt-3">
        <div class="col-4">
            <h4 class="text-center fw-semibold" style="color: #01634A;">Recados</h4>           
            <ul class="list-group">
                <div id="carouselRecados" class="carousel slide" data-bs-ride="carousel" data-bs-interval="2500">
                    <div class="carousel-inner">                        
                        {% for recado in Recados %}
                            {% if forloop.counter0 == 0 %}
                                <div class="carousel-item active rounded">
                            {% else %}
                                <div class="carousel-item rounded">
                            {% endif %}
                                <li class="list-group-item">                                        
                                    <a href="#" id="trigger_recados" data-bs-toggle="modal" data-bs-target="#modalRecado"> 
                                        <span class="col fw-semibold">{{recado.titulo}}</span>                                                                            
                                        <div class="fw-lighter recado">
                                            {{recado.texto}}
                                        </div> 
                                        <input id="recado_id" type="text" style="display: none;" value="{{ recado.id }}" /> 
                                    </a>    
                                </li>    
                            </div> 
                        {% endfor %}    
                    </div>
                </div>                                              
            </ul>
        </div>              
        <div class="col">
            <h4 class="text-center fw-semibold" style="color: #01634A;">Novos Colaboradores</h4>
            <ul class="list-group">
                <div id="carouselBirthdays" class="carousel slide" data-bs-ride="carousel" data-bs-interval="2500">
                    <div class="carousel-inner">                        
                        {% for pessoas in Admitidos %}
                            {% if forloop.counter0 == 0 %}
                                <div class="carousel-item active rounded">
                            {% else %}
                                <div class="carousel-item rounded">
                            {% endif %}
                            {% for pessoa in pessoas %}                                
                                <li class="list-group-item">
                                    <div class="row py-auto">
                                        <div class="rounded col-2">
                                            <img class="rounded" style="width: 60px; height: 60px; object-fit: cover;" src="{{ pessoa.image_url }}"></img>
                                        </div>
                                        <div class="ms-3 col align-content-center">
                                            <span class="fw-semibold">{{pessoa.nome}}</span><br> 
                                            <span>{{pessoa.funcao}} - {{pessoa.unidade}}</span>
                                        </div> 
                                    </div>
                                </li>                                     
                            {% endfor %}  
                            </div> 
                        {% endfor %}    
                    </div>
                </div>                                              
            </ul>
        </div>
        <div class="col">
            <h4 class="text-center fw-semibold">
                <a href="#" style="color: #01634A;" data-bs-toggle="modal" data-bs-target="#modalAniversariantes">
                    {{Aniversariantes.0}}
                </a>
            </h4>            
            <ul class="list-group">
                <div id="carouselBirthdays" class="carousel slide" data-bs-ride="carousel" data-bs-interval="2500">
                    <div class="carousel-inner">                        
                        {% for pessoas in Aniversariantes.1 %}
                            {% if forloop.counter0 == 0 %}
                                <div class="carousel-item active rounded">
                            {% else %}
                                <div class="carousel-item rounded">
                            {% endif %}
                            {% for aniversariante in pessoas %}                                
                                <li class="list-group-item">
                                    <div class="row py-auto">
                                        <div class="rounded col-2">
                                            <img class="rounded" style="width: 60px; height: 60px; object-fit: cover;" src="{{ aniversariante.image_url }}"></img>
                                        </div>
                                        <div class="ms-3 col align-content-center">
                                            <span class="fw-semibold">{{aniversariante.nome}}</span><br> 
                                            <span>{{aniversariante.funcao}} - {{aniversariante.unidade}}</span>
                                        </div> 
                                    </div>
                                </li>                                
                            {% endfor %}  
                            </div> 
                        {% endfor %}    
                    </div>
                </div>                                              
            </ul>
        </div>
    </div>   
    
    <div class="modal fade" id="modalAniversariantes" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="modalAniversariantesLabel">Aniversariantes do Mês</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul class="list-group">
                        {% for pessoas in Aniversariantes_Mes %}                    
                            <li class="list-group-item">
                                <div class="row">
                                    <div class="rounded col-2">
                                        <img class="rounded" style="width: 60px; height: 60px; object-fit: cover;" src="{{ pessoas.image_url }}"></img>
                                    </div>
                                    <div class="ms-2 col align-content-center">
                                        <span class="fw-semibold">{{pessoas.nome}}</span><br> 
                                        <span>{{pessoas.funcao}} - {{pessoas.unidade}}</span>
                                    </div> 
                                    <div class="col text-end align-content-center">
                                        <span class="border-success border-bottom">{{pessoas.nascimento.day|stringformat:"02d"}}/{{pessoas.nascimento.month|stringformat:"02d"}}</span>
                                    </div>
                                </div>
                            </li>                     
                        {% endfor %}  
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalRecado" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="tituloModalRecado">Título Recado</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body px-4" id="corpoModalRecado" style="color: black;"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>
      
      
{% endblock content %}

{% block scripts %}
    <script src="{% static 'home/lightbox/js/lightbox-plus-jquery.js' %}" crossorigin="anonymous"></script>
    <script src="{% static 'home/calendar_script.js' %}"></script>
    <script type="text/javascript">
        $("#trigger_recados").on("click", function() {
            var recado_id = $("#recado_id").val();

            if (recado_id) {
                var url = "/get_recado/"+recado_id;
                $.ajax({
                    url: url,
                    type: 'GET',
                    success: function(data) {  
                        $("#tituloModalRecado").text(data[0].titulo);                      
                        $("#corpoModalRecado").append(`
                            <img src='`+data[0].image+`' class='me-3 mb-3 rounded' style='width: 35vw; float: left;'/>
                            <p class='flex-grow-1'>
                                `+data[0].texto+`
                            </p>
                        `);
                    },
                    error: function(xhr, textStatus, errorThrown) {
                        console.error('Erro na solicitação:', textStatus, errorThrown);
                    }
                });
            }
        });
    </script>
{% endblock %}